<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=yes" />
<title>Flipbook</title>
<style>
* { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

:root {
  --bg: #2b2b2b;
  --surface: #252525;
  --surface-hover: #2f2f2f;
  --text: #e8e8e8;
  --text-dim: #a0a0a0;
  --accent: #3b82f6;
  --border: rgba(255,255,255,0.08);
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#loading {
  position: fixed;
  inset: 0;
  background: var(--bg);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 0.3s ease;
}

#loading.hidden {
  opacity: 0;
  pointer-events: none;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 3px solid rgba(59, 130, 246, 0.2);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

#app {
  display: flex;
  height: 100vh;
  width: 100vw;
}

#main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

#viewer {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  position: relative;
  overflow: hidden;
}

#book-container {
  position: relative;
  cursor: grab;
  transition: transform 0.3s ease;
}

#book-container.zoomed {
  cursor: move;
}

#book-container.grabbing {
  cursor: grabbing;
}

#flipbook {
  outline: none;
  box-shadow: 0 30px 80px rgba(0,0,0,0.8), 0 0 40px rgba(0,0,0,0.4);
  transform-style: preserve-3d;
  will-change: transform;
  transform: translateZ(0);
  border-radius: 3px;
  overflow: visible;
}

.turnjs-page {
  background: white !important;
  overflow: hidden;
  transform: translateZ(0);
  backface-visibility: hidden;
  will-change: transform;
  box-shadow: inset 0 0 30px rgba(0,0,0,0.1);
  position: relative;
}

.turnjs-page::before {
  content: '';
  position: absolute;
  top: 0;
  bottom: 0;
  width: 30px;
  background: linear-gradient(to right, rgba(0,0,0,0.15), transparent);
  z-index: 1;
  pointer-events: none;
}

.turnjs-page:nth-child(even)::before {
  left: 0;
}

.turnjs-page:nth-child(odd)::before {
  right: 0;
  background: linear-gradient(to left, rgba(0,0,0,0.15), transparent);
}

.turnjs-page img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
  user-select: none;
  -webkit-user-drag: none;
  pointer-events: none;
  transform: translateZ(0);
}

.blank-page {
  background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%) !important;
}

.page-zone {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 48%;
  z-index: 10;
  cursor: pointer;
  transition: background 0.2s ease;
}

.page-zone.left {
  left: 0;
}

.page-zone.right {
  right: 0;
}

.page-zone:hover {
  background: rgba(0,0,0,0.02);
}

.page-zone.left:hover::after {
  content: '‚óÄ';
  position: absolute;
  left: 30px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 28px;
  color: rgba(0,0,0,0.15);
  animation: slideLeft 0.6s ease-in-out infinite;
}

.page-zone.right:hover::after {
  content: '‚ñ∂';
  position: absolute;
  right: 30px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 28px;
  color: rgba(0,0,0,0.15);
  animation: slideRight 0.6s ease-in-out infinite;
}

@keyframes slideLeft {
  0%, 100% { transform: translateY(-50%) translateX(0); }
  50% { transform: translateY(-50%) translateX(-5px); }
}

@keyframes slideRight {
  0%, 100% { transform: translateY(-50%) translateX(0); }
  50% { transform: translateY(-50%) translateX(5px); }
}

#book-container.zoomed .page-zone {
  display: none;
}

#controls {
  height: 70px;
  background: var(--surface);
  border-top: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  padding: 0 20px;
  z-index: 100;
}

.control-btn {
  width: 44px;
  height: 44px;
  background: transparent;
  border: none;
  color: var(--text);
  border-radius: 10px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  transition: background 0.2s ease, transform 0.1s ease;
}

.control-btn:hover {
  background: var(--surface-hover);
}

.control-btn:active {
  transform: scale(0.92);
}

.control-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

#page-info {
  padding: 10px 20px;
  background: var(--surface-hover);
  border-radius: 10px;
  font-size: 14px;
  font-weight: 500;
  color: var(--text-dim);
  min-width: 110px;
  text-align: center;
  user-select: none;
}

#zoom-level {
  padding: 8px 16px;
  background: var(--surface-hover);
  border-radius: 10px;
  font-size: 13px;
  color: var(--text-dim);
  min-width: 80px;
  text-align: center;
  user-select: none;
}

#sidebar {
  width: 0;
  background: var(--surface);
  border-left: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 150;
}

#sidebar.open {
  width: 240px;
}

#sidebar-header {
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  border-bottom: 1px solid var(--border);
  opacity: 0;
  transition: opacity 0.2s ease;
}

#sidebar.open #sidebar-header {
  opacity: 1;
  transition-delay: 0.15s;
}

#sidebar-title {
  font-size: 13px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-dim);
}

#close-sidebar {
  width: 32px;
  height: 32px;
  background: transparent;
  border: none;
  color: var(--text-dim);
  cursor: pointer;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  font-size: 20px;
}

#close-sidebar:hover {
  background: var(--surface-hover);
  color: var(--text);
}

#thumbnails {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  opacity: 0;
  transition: opacity 0.2s ease;
}

#sidebar.open #thumbnails {
  opacity: 1;
  transition-delay: 0.2s;
}

#thumbnails::-webkit-scrollbar {
  width: 6px;
}

#thumbnails::-webkit-scrollbar-track {
  background: transparent;
}

#thumbnails::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.15);
  border-radius: 3px;
}

.thumb {
  margin-bottom: 12px;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  position: relative;
  border: 2px solid transparent;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.thumb:hover {
  border-color: var(--accent);
  transform: translateX(-4px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
}

.thumb.active {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
}

.thumb img {
  width: 100%;
  display: block;
  background: white;
}

.thumb-num {
  position: absolute;
  bottom: 6px;
  right: 6px;
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 3px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
}

#toggle-sidebar {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 48px;
  height: 48px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  color: var(--text);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  z-index: 200;
  transition: all 0.2s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

#toggle-sidebar:hover {
  background: var(--surface-hover);
  transform: scale(1.05);
}

@media (max-width: 768px) {
  #viewer { padding: 10px 10px 80px 10px; }
  #controls { 
    height: 70px; 
    gap: 6px; 
    padding: 0 8px;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background: var(--surface);
    box-shadow: 0 -4px 12px rgba(0,0,0,0.3);
    overflow-x: auto;
  }
  .control-btn { width: 40px; height: 40px; font-size: 18px; flex-shrink: 0; }
  #page-info { padding: 8px 12px; font-size: 13px; min-width: 75px; flex-shrink: 0; }
  #zoom-level { padding: 6px 10px; font-size: 12px; min-width: 65px; flex-shrink: 0; }
  #sidebar.open { width: 200px; }
  #toggle-sidebar { top: 12px; right: 12px; width: 44px; height: 44px; }
  .page-zone.left:hover::after,
  .page-zone.right:hover::after {
    display: none;
  }
}

@media (max-width: 480px) {
  #sidebar.open { 
    position: fixed;
    inset: 0;
    width: 100%;
    max-width: 280px;
    z-index: 250;
    box-shadow: -4px 0 20px rgba(0,0,0,0.5);
  }
}
</style>
</head>
<body>

<div id="loading">
  <div class="spinner"></div>
</div>

<div id="app">
  <div id="main-content">
    <div id="viewer">
      <div id="book-container">
        <div id="flipbook"></div>
      </div>
    </div>
    
    <div id="controls">
      <button class="control-btn" id="btn-first" title="First page">‚èÆ</button>
      <button class="control-btn" id="btn-prev" title="Previous">‚óÄ</button>
      <div id="page-info"></div>
      <button class="control-btn" id="btn-next" title="Next">‚ñ∂</button>
      <button class="control-btn" id="btn-last" title="Last page">‚è≠</button>
      <button class="control-btn" id="btn-zoom-out" title="Zoom out">üîç‚àí</button>
      <div id="zoom-level">100%</div>
      <button class="control-btn" id="btn-zoom-in" title="Zoom in">üîç+</button>
      <button class="control-btn" id="btn-zoom-reset" title="Reset zoom">‚ü≤</button>
      <button class="control-btn" id="btn-fullscreen" title="Fullscreen">‚õ∂</button>
    </div>
  </div>

  <div id="sidebar">
    <div id="sidebar-header">
      <div id="sidebar-title">Pages</div>
      <button id="close-sidebar">‚úï</button>
    </div>
    <div id="thumbnails"></div>
  </div>
</div>

<button id="toggle-sidebar" title="Show pages">‚ò∞</button>

<script id="pages-data" type="application/json">[{"webp": "page-0001.webp", "webp2x": "page-0001@2x.webp"}, {"webp": "page-0002.webp", "webp2x": "page-0002@2x.webp"}, {"webp": "page-0003.webp", "webp2x": "page-0003@2x.webp"}, {"webp": "page-0004.webp", "webp2x": "page-0004@2x.webp"}, {"webp": "page-0005.webp", "webp2x": "page-0005@2x.webp"}, {"webp": "page-0006.webp", "webp2x": "page-0006@2x.webp"}, {"webp": "page-0007.webp", "webp2x": "page-0007@2x.webp"}, {"webp": "page-0008.webp", "webp2x": "page-0008@2x.webp"}, {"webp": "page-0009.webp", "webp2x": "page-0009@2x.webp"}, {"webp": "page-0010.webp", "webp2x": "page-0010@2x.webp"}, {"webp": "page-0011.webp", "webp2x": "page-0011@2x.webp"}, {"webp": "page-0012.webp", "webp2x": "page-0012@2x.webp"}, {"webp": "page-0013.webp", "webp2x": "page-0013@2x.webp"}, {"webp": "page-0014.webp", "webp2x": "page-0014@2x.webp"}, {"webp": "page-0015.webp", "webp2x": "page-0015@2x.webp"}, {"webp": "page-0016.webp", "webp2x": "page-0016@2x.webp"}, {"webp": "page-0017.webp", "webp2x": "page-0017@2x.webp"}, {"webp": "page-0018.webp", "webp2x": "page-0018@2x.webp"}, {"webp": "page-0019.webp", "webp2x": "page-0019@2x.webp"}, {"webp": "page-0020.webp", "webp2x": "page-0020@2x.webp"}, {"webp": "page-0021.webp", "webp2x": "page-0021@2x.webp"}, {"webp": "page-0022.webp", "webp2x": "page-0022@2x.webp"}, {"webp": "page-0023.webp", "webp2x": "page-0023@2x.webp"}, {"webp": "page-0024.webp", "webp2x": "page-0024@2x.webp"}, {"webp": "page-0025.webp", "webp2x": "page-0025@2x.webp"}, {"webp": "page-0026.webp", "webp2x": "page-0026@2x.webp"}, {"webp": "page-0027.webp", "webp2x": "page-0027@2x.webp"}, {"webp": "page-0028.webp", "webp2x": "page-0028@2x.webp"}, {"webp": "page-0029.webp", "webp2x": "page-0029@2x.webp"}, {"webp": "page-0030.webp", "webp2x": "page-0030@2x.webp"}, {"webp": "page-0031.webp", "webp2x": "page-0031@2x.webp"}, {"webp": "page-0032.webp", "webp2x": "page-0032@2x.webp"}, {"webp": "page-0033.webp", "webp2x": "page-0033@2x.webp"}, {"webp": "page-0034.webp", "webp2x": "page-0034@2x.webp"}, {"webp": "page-0035.webp", "webp2x": "page-0035@2x.webp"}, {"webp": "page-0036.webp", "webp2x": "page-0036@2x.webp"}, {"webp": "page-0037.webp", "webp2x": "page-0037@2x.webp"}, {"webp": "page-0038.webp", "webp2x": "page-0038@2x.webp"}, {"webp": "page-0039.webp", "webp2x": "page-0039@2x.webp"}, {"webp": "page-0040.webp", "webp2x": "page-0040@2x.webp"}, {"webp": "page-0041.webp", "webp2x": "page-0041@2x.webp"}, {"webp": "page-0042.webp", "webp2x": "page-0042@2x.webp"}, {"webp": "page-0043.webp", "webp2x": "page-0043@2x.webp"}, {"webp": "page-0044.webp", "webp2x": "page-0044@2x.webp"}, {"webp": "page-0045.webp", "webp2x": "page-0045@2x.webp"}, {"webp": "page-0046.webp", "webp2x": "page-0046@2x.webp"}, {"webp": "page-0047.webp", "webp2x": "page-0047@2x.webp"}, {"webp": "page-0048.webp", "webp2x": "page-0048@2x.webp"}, {"webp": "page-0049.webp", "webp2x": "page-0049@2x.webp"}, {"webp": "page-0050.webp", "webp2x": "page-0050@2x.webp"}, {"webp": "page-0051.webp", "webp2x": "page-0051@2x.webp"}, {"webp": "page-0052.webp", "webp2x": "page-0052@2x.webp"}, {"webp": "page-0053.webp", "webp2x": "page-0053@2x.webp"}, {"webp": "page-0054.webp", "webp2x": "page-0054@2x.webp"}, {"webp": "page-0055.webp", "webp2x": "page-0055@2x.webp"}, {"webp": "page-0056.webp", "webp2x": "page-0056@2x.webp"}, {"webp": "page-0057.webp", "webp2x": "page-0057@2x.webp"}, {"webp": "page-0058.webp", "webp2x": "page-0058@2x.webp"}, {"webp": "page-0059.webp", "webp2x": "page-0059@2x.webp"}, {"webp": "page-0060.webp", "webp2x": "page-0060@2x.webp"}, {"webp": "page-0061.webp", "webp2x": "page-0061@2x.webp"}, {"webp": "page-0062.webp", "webp2x": "page-0062@2x.webp"}, {"webp": "page-0063.webp", "webp2x": "page-0063@2x.webp"}, {"webp": "page-0064.webp", "webp2x": "page-0064@2x.webp"}, {"webp": "page-0065.webp", "webp2x": "page-0065@2x.webp"}, {"webp": "page-0066.webp", "webp2x": "page-0066@2x.webp"}, {"webp": "page-0067.webp", "webp2x": "page-0067@2x.webp"}, {"webp": "page-0068.webp", "webp2x": "page-0068@2x.webp"}, {"webp": "page-0069.webp", "webp2x": "page-0069@2x.webp"}, {"webp": "page-0070.webp", "webp2x": "page-0070@2x.webp"}, {"webp": "page-0071.webp", "webp2x": "page-0071@2x.webp"}, {"webp": "page-0072.webp", "webp2x": "page-0072@2x.webp"}, {"webp": "page-0073.webp", "webp2x": "page-0073@2x.webp"}, {"webp": "page-0074.webp", "webp2x": "page-0074@2x.webp"}, {"webp": "page-0075.webp", "webp2x": "page-0075@2x.webp"}, {"webp": "page-0076.webp", "webp2x": "page-0076@2x.webp"}, {"webp": "page-0077.webp", "webp2x": "page-0077@2x.webp"}, {"webp": "page-0078.webp", "webp2x": "page-0078@2x.webp"}, {"webp": "page-0079.webp", "webp2x": "page-0079@2x.webp"}, {"webp": "page-0080.webp", "webp2x": "page-0080@2x.webp"}, {"webp": "page-0081.webp", "webp2x": "page-0081@2x.webp"}, {"webp": "page-0082.webp", "webp2x": "page-0082@2x.webp"}, {"webp": "page-0083.webp", "webp2x": "page-0083@2x.webp"}, {"webp": "page-0084.webp", "webp2x": "page-0084@2x.webp"}, {"webp": "page-0085.webp", "webp2x": "page-0085@2x.webp"}, {"webp": "page-0086.webp", "webp2x": "page-0086@2x.webp"}, {"webp": "page-0087.webp", "webp2x": "page-0087@2x.webp"}, {"webp": "page-0088.webp", "webp2x": "page-0088@2x.webp"}, {"webp": "page-0089.webp", "webp2x": "page-0089@2x.webp"}, {"webp": "page-0090.webp", "webp2x": "page-0090@2x.webp"}, {"webp": "page-0091.webp", "webp2x": "page-0091@2x.webp"}, {"webp": "page-0092.webp", "webp2x": "page-0092@2x.webp"}, {"webp": "page-0093.webp", "webp2x": "page-0093@2x.webp"}, {"webp": "page-0094.webp", "webp2x": "page-0094@2x.webp"}, {"webp": "page-0095.webp", "webp2x": "page-0095@2x.webp"}, {"webp": "page-0096.webp", "webp2x": "page-0096@2x.webp"}, {"webp": "page-0097.webp", "webp2x": "page-0097@2x.webp"}, {"webp": "page-0098.webp", "webp2x": "page-0098@2x.webp"}, {"webp": "page-0099.webp", "webp2x": "page-0099@2x.webp"}, {"webp": "page-0100.webp", "webp2x": "page-0100@2x.webp"}, {"webp": "page-0101.webp", "webp2x": "page-0101@2x.webp"}, {"webp": "page-0102.webp", "webp2x": "page-0102@2x.webp"}, {"webp": "page-0103.webp", "webp2x": "page-0103@2x.webp"}, {"webp": "page-0104.webp", "webp2x": "page-0104@2x.webp"}, {"webp": "page-0105.webp", "webp2x": "page-0105@2x.webp"}, {"webp": "page-0106.webp", "webp2x": "page-0106@2x.webp"}, {"webp": "page-0107.webp", "webp2x": "page-0107@2x.webp"}, {"webp": "page-0108.webp", "webp2x": "page-0108@2x.webp"}, {"webp": "page-0109.webp", "webp2x": "page-0109@2x.webp"}, {"webp": "page-0110.webp", "webp2x": "page-0110@2x.webp"}, {"webp": "page-0111.webp", "webp2x": "page-0111@2x.webp"}, {"webp": "page-0112.webp", "webp2x": "page-0112@2x.webp"}, {"webp": "page-0113.webp", "webp2x": "page-0113@2x.webp"}, {"webp": "page-0114.webp", "webp2x": "page-0114@2x.webp"}, {"webp": "page-0115.webp", "webp2x": "page-0115@2x.webp"}, {"webp": "page-0116.webp", "webp2x": "page-0116@2x.webp"}, {"webp": "page-0117.webp", "webp2x": "page-0117@2x.webp"}, {"webp": "page-0118.webp", "webp2x": "page-0118@2x.webp"}, {"webp": "page-0119.webp", "webp2x": "page-0119@2x.webp"}, {"webp": "page-0120.webp", "webp2x": "page-0120@2x.webp"}, {"webp": "page-0121.webp", "webp2x": "page-0121@2x.webp"}, {"webp": "page-0122.webp", "webp2x": "page-0122@2x.webp"}, {"webp": "page-0123.webp", "webp2x": "page-0123@2x.webp"}, {"webp": "page-0124.webp", "webp2x": "page-0124@2x.webp"}, {"webp": "page-0125.webp", "webp2x": "page-0125@2x.webp"}, {"webp": "page-0126.webp", "webp2x": "page-0126@2x.webp"}, {"webp": "page-0127.webp", "webp2x": "page-0127@2x.webp"}, {"webp": "page-0128.webp", "webp2x": "page-0128@2x.webp"}, {"webp": "page-0129.webp", "webp2x": "page-0129@2x.webp"}, {"webp": "page-0130.webp", "webp2x": "page-0130@2x.webp"}, {"webp": "page-0131.webp", "webp2x": "page-0131@2x.webp"}, {"webp": "page-0132.webp", "webp2x": "page-0132@2x.webp"}, {"webp": "page-0133.webp", "webp2x": "page-0133@2x.webp"}, {"webp": "page-0134.webp", "webp2x": "page-0134@2x.webp"}, {"webp": "page-0135.webp", "webp2x": "page-0135@2x.webp"}, {"webp": "page-0136.webp", "webp2x": "page-0136@2x.webp"}, {"webp": "page-0137.webp", "webp2x": "page-0137@2x.webp"}, {"webp": "page-0138.webp", "webp2x": "page-0138@2x.webp"}, {"webp": "page-0139.webp", "webp2x": "page-0139@2x.webp"}, {"webp": "page-0140.webp", "webp2x": "page-0140@2x.webp"}, {"webp": "page-0141.webp", "webp2x": "page-0141@2x.webp"}, {"webp": "page-0142.webp", "webp2x": "page-0142@2x.webp"}, {"webp": "page-0143.webp", "webp2x": "page-0143@2x.webp"}, {"webp": "page-0144.webp", "webp2x": "page-0144@2x.webp"}, {"webp": "page-0145.webp", "webp2x": "page-0145@2x.webp"}, {"webp": "page-0146.webp", "webp2x": "page-0146@2x.webp"}, {"webp": "page-0147.webp", "webp2x": "page-0147@2x.webp"}, {"webp": "page-0148.webp", "webp2x": "page-0148@2x.webp"}, {"webp": "page-0149.webp", "webp2x": "page-0149@2x.webp"}, {"webp": "page-0150.webp", "webp2x": "page-0150@2x.webp"}, {"webp": "page-0151.webp", "webp2x": "page-0151@2x.webp"}, {"webp": "page-0152.webp", "webp2x": "page-0152@2x.webp"}, {"webp": "page-0153.webp", "webp2x": "page-0153@2x.webp"}, {"webp": "page-0154.webp", "webp2x": "page-0154@2x.webp"}, {"webp": "page-0155.webp", "webp2x": "page-0155@2x.webp"}, {"webp": "page-0156.webp", "webp2x": "page-0156@2x.webp"}, {"webp": "page-0157.webp", "webp2x": "page-0157@2x.webp"}, {"webp": "page-0158.webp", "webp2x": "page-0158@2x.webp"}, {"webp": "page-0159.webp", "webp2x": "page-0159@2x.webp"}, {"webp": "page-0160.webp", "webp2x": "page-0160@2x.webp"}, {"webp": "page-0161.webp", "webp2x": "page-0161@2x.webp"}, {"webp": "page-0162.webp", "webp2x": "page-0162@2x.webp"}, {"webp": "page-0163.webp", "webp2x": "page-0163@2x.webp"}, {"webp": "page-0164.webp", "webp2x": "page-0164@2x.webp"}, {"webp": "page-0165.webp", "webp2x": "page-0165@2x.webp"}, {"webp": "page-0166.webp", "webp2x": "page-0166@2x.webp"}, {"webp": "page-0167.webp", "webp2x": "page-0167@2x.webp"}, {"webp": "page-0168.webp", "webp2x": "page-0168@2x.webp"}, {"webp": "page-0169.webp", "webp2x": "page-0169@2x.webp"}, {"webp": "page-0170.webp", "webp2x": "page-0170@2x.webp"}, {"webp": "page-0171.webp", "webp2x": "page-0171@2x.webp"}, {"webp": "page-0172.webp", "webp2x": "page-0172@2x.webp"}, {"webp": "page-0173.webp", "webp2x": "page-0173@2x.webp"}, {"webp": "page-0174.webp", "webp2x": "page-0174@2x.webp"}, {"webp": "page-0175.webp", "webp2x": "page-0175@2x.webp"}, {"webp": "page-0176.webp", "webp2x": "page-0176@2x.webp"}, {"webp": "page-0177.webp", "webp2x": "page-0177@2x.webp"}, {"webp": "page-0178.webp", "webp2x": "page-0178@2x.webp"}, {"webp": "page-0179.webp", "webp2x": "page-0179@2x.webp"}, {"webp": "page-0180.webp", "webp2x": "page-0180@2x.webp"}, {"webp": "page-0181.webp", "webp2x": "page-0181@2x.webp"}, {"webp": "page-0182.webp", "webp2x": "page-0182@2x.webp"}, {"webp": "page-0183.webp", "webp2x": "page-0183@2x.webp"}, {"webp": "page-0184.webp", "webp2x": "page-0184@2x.webp"}]</script>
<script src="./assets/jquery.min.js"></script>
<script src="./assets/turn.min.js"></script>

<script>
(function() {
  'use strict';

  const CONFIG = {
    MOBILE_BREAKPOINT: 768,
    TURN_DURATION: 600,
    TURN_ELEVATION: 50,
    ZOOM_MIN: 1,
    ZOOM_MAX: 3,
    ZOOM_STEP: 0.25,
    RESIZE_DEBOUNCE: 250
  };

  let pages = [];
  try {
    const raw = document.getElementById('pages-data').textContent;
    pages = raw ? JSON.parse(raw) : [];
  } catch (e) {
    console.error('Parse error:', e);
  }

  const loading = document.getElementById('loading');
  const viewer = document.getElementById('viewer');
  const bookContainer = document.getElementById('book-container');
  const sidebar = document.getElementById('sidebar');
  const thumbnails = document.getElementById('thumbnails');
  const pageInfo = document.getElementById('page-info');
  const zoomLevel = document.getElementById('zoom-level');

  let currentPage = 1;
  let zoomScale = 1;
  let turnInstance = null;
  let isPanning = false;
  let panStart = { x: 0, y: 0 };
  let panOffset = { x: 0, y: 0 };

  function buildPageArray() {
    const arr = [];
    if (pages.length % 2 === 1) arr.push({ blank: true });
    pages.forEach(p => arr.push(p));
    return arr;
  }

  const pageArray = buildPageArray();

  function loadImage(src) {
    return new Promise((resolve) => {
      const img = new Image();
      img.onload = () => resolve(img);
      img.onerror = () => resolve(null);
      img.src = src;
    });
  }

  function getFirstSrc() {
    for (let p of pageArray) {
      if (!p.blank) return './pages/' + p.webp;
    }
    return null;
  }

  function initFlipbook() {
    const firstSrc = getFirstSrc();
    if (!firstSrc) {
      setupFlipbook(210/297);
      return;
    }

    loadImage(firstSrc).then(img => {
      const aspect = img ? img.naturalWidth / img.naturalHeight : 210/297;
      setupFlipbook(aspect);
    });
  }

  function setupFlipbook(aspect) {
    const isMobile = window.innerWidth <= CONFIG.MOBILE_BREAKPOINT;
    const mode = isMobile ? 'single' : 'double';
    
    const box = viewer.getBoundingClientRect();
    const availW = Math.max(300, box.width - 40);
    const availH = Math.max(200, box.height - 40);

    let width, height;
    if (mode === 'double') {
      const pageW = Math.min(availW / 2, availH * aspect);
      const pageH = pageW / aspect;
      width = Math.max(400, pageW * 2);
      height = Math.max(300, pageH);
    } else {
      height = Math.min(availH, availW / aspect);
      width = Math.max(200, height * aspect);
    }

    const fb = $('#flipbook');
    if (turnInstance) {
      try {
        fb.turn('destroy');
        turnInstance = null;
      } catch (e) {}
    }
    
    fb.empty();

    pageArray.forEach((p, idx) => {
      const div = $('<div>').addClass('turnjs-page');
      
      if (p.blank) {
        div.addClass('blank-page');
      } else {
        const img = $('<img>')
          .attr('src', './pages/' + p.webp)
          .attr('loading', 'eager')
          .attr('alt', 'Page ' + (idx + 1));
        
        if (p.webp2x) {
          img.attr('srcset', `./pages/${p.webp} 1x, ./pages/${p.webp2x} 2x`);
        }
        
        div.append(img);
      }
      
      fb.append(div);
    });

    fb.css({ 
      width: Math.round(width) + 'px', 
      height: Math.round(height) + 'px' 
    });

    try {
      fb.turn({
        width: Math.round(width),
        height: Math.round(height),
        autoCenter: true,
        display: mode,
        pages: pageArray.length,
        elevation: CONFIG.TURN_ELEVATION,
        gradients: true,
        acceleration: true,
        duration: CONFIG.TURN_DURATION,
        page: currentPage,
        when: {
          turned: function(e, page) {
            currentPage = page;
            updateUI();
          }
        }
      });
      
      turnInstance = true;
      addClickZones();
    } catch (err) {
      console.error('Turn.js error:', err);
    }

    buildThumbnails();
    updateUI();
    
    setTimeout(() => {
      loading.classList.add('hidden');
    }, 100);
  }

  function addClickZones() {
    setTimeout(() => {
      $('.turnjs-page').each(function() {
        const page = $(this);
        page.find('.page-zone').remove();
        
        const left = $('<div class="page-zone left"></div>');
        const right = $('<div class="page-zone right"></div>');
        
        left.on('click', e => {
          e.stopPropagation();
          if (zoomScale === 1) prevPage();
        });
        
        right.on('click', e => {
          e.stopPropagation();
          if (zoomScale === 1) nextPage();
        });
        
        page.append(left, right);
      });
    }, 100);
  }

  function buildThumbnails() {
    if (thumbnails.children.length > 0) return;
    
    pageArray.forEach((p, idx) => {
      if (p.blank) return;
      
      const thumb = document.createElement('div');
      thumb.className = 'thumb';
      thumb.dataset.page = idx + 1;
      
      const img = document.createElement('img');
      img.src = './pages/' + p.webp;
      img.alt = 'Page ' + (idx + 1);
      img.loading = 'lazy';
      
      const num = document.createElement('div');
      num.className = 'thumb-num';
      num.textContent = idx + 1;
      
      thumb.appendChild(img);
      thumb.appendChild(num);
      
      thumb.addEventListener('click', () => {
        goToPage(parseInt(thumb.dataset.page));
        if (window.innerWidth <= 480) {
          sidebar.classList.remove('open');
        }
      });
      
      thumbnails.appendChild(thumb);
    });
  }

  function updateUI() {
    pageInfo.textContent = `${currentPage} / ${pageArray.length}`;
    zoomLevel.textContent = Math.round(zoomScale * 100) + '%';
    
    document.getElementById('btn-zoom-in').disabled = zoomScale >= CONFIG.ZOOM_MAX;
    document.getElementById('btn-zoom-out').disabled = zoomScale <= CONFIG.ZOOM_MIN;
    document.getElementById('btn-zoom-reset').disabled = zoomScale === 1 && panOffset.x === 0 && panOffset.y === 0;
    
    document.querySelectorAll('.thumb').forEach(thumb => {
      if (parseInt(thumb.dataset.page) === currentPage) {
        thumb.classList.add('active');
        if (sidebar.classList.contains('open')) {
          thumb.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      } else {
        thumb.classList.remove('active');
      }
    });
  }

  function applyZoom() {
    const transform = `scale(${zoomScale}) translate(${panOffset.x}px, ${panOffset.y}px)`;
    bookContainer.style.transform = transform;
    
    if (zoomScale > 1) {
      bookContainer.classList.add('zoomed');
    } else {
      bookContainer.classList.remove('zoomed');
    }
    
    updateUI();
  }

  function zoomIn() {
    if (zoomScale < CONFIG.ZOOM_MAX) {
      zoomScale = Math.min(CONFIG.ZOOM_MAX, zoomScale + CONFIG.ZOOM_STEP);
      applyZoom();
    }
  }

  function zoomOut() {
    if (zoomScale > CONFIG.ZOOM_MIN) {
      zoomScale = Math.max(CONFIG.ZOOM_MIN, zoomScale - CONFIG.ZOOM_STEP);
      if (zoomScale === 1) {
        panOffset = { x: 0, y: 0 };
      }
      applyZoom();
    }
  }

  function resetZoom() {
    zoomScale = 1;
    panOffset = { x: 0, y: 0 };
    applyZoom();
  }

  bookContainer.addEventListener('mousedown', e => {
    if (zoomScale > 1) {
      isPanning = true;
      panStart = { x: e.clientX - panOffset.x, y: e.clientY - panOffset.y };
      bookContainer.classList.add('grabbing');
    }
  });

  document.addEventListener('mousemove', e => {
    if (isPanning && zoomScale > 1) {
      panOffset.x = e.clientX - panStart.x;
      panOffset.y = e.clientY - panStart.y;
      applyZoom();
    }
  });

  document.addEventListener('mouseup', () => {
    if (isPanning) {
      isPanning = false;
      bookContainer.classList.remove('grabbing');
    }
  });

  bookContainer.addEventListener('touchstart', e => {
    if (zoomScale > 1 && e.touches.length === 1) {
      isPanning = true;
      const touch = e.touches[0];
      panStart = { x: touch.clientX - panOffset.x, y: touch.clientY - panOffset.y };
    }
  });

  bookContainer.addEventListener('touchmove', e => {
    if (isPanning && zoomScale > 1 && e.touches.length === 1) {
      e.preventDefault();
      const touch = e.touches[0];
      panOffset.x = touch.clientX - panStart.x;
      panOffset.y = touch.clientY - panStart.y;
      applyZoom();
    }
  }, { passive: false });

  bookContainer.addEventListener('touchend', () => {
    isPanning = false;
  });

  function prevPage() {
    try { $('#flipbook').turn('previous'); } catch (e) {}
  }

  function nextPage() {
    try { $('#flipbook').turn('next'); } catch (e) {}
  }

  function goToPage(page) {
    try { $('#flipbook').turn('page', page); } catch (e) {}
  }

  function firstPage() {
    goToPage(1);
  }

  function lastPage() {
    goToPage(pageArray.length);
  }

  document.getElementById('btn-prev').addEventListener('click', prevPage);
  document.getElementById('btn-next').addEventListener('click', nextPage);
  document.getElementById('btn-first').addEventListener('click', firstPage);
  document.getElementById('btn-last').addEventListener('click', lastPage);
  document.getElementById('btn-zoom-in').addEventListener('click', zoomIn);
  document.getElementById('btn-zoom-out').addEventListener('click', zoomOut);
  document.getElementById('btn-zoom-reset').addEventListener('click', resetZoom);

  document.getElementById('btn-fullscreen').addEventListener('click', () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch(e => {});
    } else {
      document.exitFullscreen();
    }
  });

  document.getElementById('toggle-sidebar').addEventListener('click', () => {
    sidebar.classList.toggle('open');
    if (sidebar.classList.contains('open')) {
      updateUI();
    }
  });

  document.getElementById('close-sidebar').addEventListener('click', () => {
    sidebar.classList.remove('open');
  });

  window.addEventListener('keydown', e => {
    switch(e.key) {
      case 'ArrowLeft':
      case 'PageUp':
        e.preventDefault();
        if (zoomScale === 1) prevPage();
        break;
      case 'ArrowRight':
      case 'PageDown':
      case ' ':
        e.preventDefault();
        if (zoomScale === 1) nextPage();
        break;
      case 'Home':
        e.preventDefault();
        firstPage();
        break;
      case 'End':
        e.preventDefault();
        lastPage();
        break;
      case '+':
      case '=':
        e.preventDefault();
        zoomIn();
        break;
      case '-':
      case '_':
        e.preventDefault();
        zoomOut();
        break;
      case '0':
        e.preventDefault();
        resetZoom();
        break;
      case 'Escape':
        sidebar.classList.remove('open');
        if (document.fullscreenElement) {
          document.exitFullscreen();
        }
        break;
    }
  });

  document.addEventListener('fullscreenchange', () => {
    setTimeout(() => {
      const prevPage = currentPage;
      resetZoom();
      initFlipbook();
      setTimeout(() => goToPage(prevPage), 100);
    }, 100);
  });

  let resizeTimer;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      const prevPage = currentPage;
      resetZoom();
      initFlipbook();
      setTimeout(() => goToPage(prevPage), 100);
    }, CONFIG.RESIZE_DEBOUNCE);
  });

  initFlipbook();
})();
</script>
</body>
</html>
